"use strict";(()=>{var e={};e.id=821,e.ids=[821],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7158:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{GET:()=>p});var s=r(2390),n=r(1498),i=r(9308),o=r(7024),l=r(5288);async function u(e){let t;let r=await l._.property.findUnique({where:{id:e},include:{insuranceClaims:!0,workEvents:!0,rentalSignals:!0,ownershipEvents:!0}});if(!r)return 0;if(t=0+(Math.min(10*r.insuranceClaims.length,30)+5*r.insuranceClaims.filter(e=>null!=e.amount&&e.amount>2e4).length),r.workEvents.filter(e=>{let t=new Date(e.workDate),r=new Date;return r.setFullYear(r.getFullYear()-2),t>r}).length>5&&(t+=15),r.rentalSignals.reduce((e,t)=>{let r=t.startDate?new Date(t.startDate):new Date;return e+((t.endDate?new Date(t.endDate):new Date).getTime()-r.getTime())/31536e6},0)>5&&(t+=10),r.yearBuilt){let e=new Date().getFullYear()-r.yearBuilt;e>30&&(t+=10),e>50&&(t+=5)}return r.ownershipEvents.length>4&&(t+=10),Math.min(Math.round(t),100)}async function p(e,{params:t}){try{let e=await l._.property.findUnique({where:{id:t.id},include:{insuranceClaims:!0,workEvents:!0,rentalSignals:!0,ownershipEvents:!0}});if(!e)return o.Z.json({error:"Property not found"},{status:404});let r=await u(t.id),a=[];if(e.insuranceClaims.length>0&&a.push({type:"insurance_claims",severity:e.insuranceClaims.length>2?"high":"medium",message:`${e.insuranceClaims.length} insurance claim${1!==e.insuranceClaims.length?"s":""} on record`,details:e.insuranceClaims.map(e=>({type:e.claimType,date:e.claimDate,amount:e.amount}))}),e.workEvents.length>5&&a.push({type:"frequent_repairs",severity:"medium",message:`${e.workEvents.length} work events recorded - may indicate ongoing issues`}),e.rentalSignals.length>0){let t=e.rentalSignals.reduce((e,t)=>{let r=t.startDate?new Date(t.startDate):new Date,a=t.endDate?new Date(t.endDate):new Date;return e+(a.getTime()-r.getTime())/31536e6},0);t>3&&a.push({type:"rental_history",severity:"low",message:`Property rented for ${t.toFixed(1)} years - potential for more wear`})}return e.yearBuilt&&new Date().getFullYear()-e.yearBuilt>30&&a.push({type:"property_age",severity:"medium",message:`Property built in ${e.yearBuilt} - major systems may need attention`}),o.Z.json({score:r,level:r<30?"Low":r<60?"Moderate":"High",color:r<30?"green":r<60?"yellow":"red",factors:a,recommendation:r<30?"This property shows a low risk profile with minimal concerns.":r<60?"This property has some risk factors to consider. Review the details below.":"This property has multiple risk factors. We recommend a thorough inspection and review of all records."})}catch(e){return console.error("Risk assessment error:",e),o.Z.json({error:"Failed to calculate risk assessment"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/properties/[id]/risk-assessment/route",pathname:"/api/properties/[id]/risk-assessment",filename:"route",bundlePath:"app/api/properties/[id]/risk-assessment/route"},resolvedPagePath:"/Users/jonathanguyen/truehome/apps/web/src/app/api/properties/[id]/risk-assessment/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:h,headerHooks:g,staticGenerationBailout:w}=m,y="/api/properties/[id]/risk-assessment/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}},5288:(e,t,r)=>{r.d(t,{_:()=>s});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient({log:["error"]})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[369,587],()=>r(7158));module.exports=a})();